= 梦云智软件开发团队 核心库

== 版本信息

* 1.5.3.RELEASE
* 1.5.3.1-RELEASE
* 2.0.2.RELEASE
* 2.0.5.1
* 2.0.5.2
* 2.1.7.0 **(最新版本) **
* 3.0.0.RELEASE (该版本未与spring boot版本相对应，请升级至2.X版本)
* 3.0.1.release (该版本未与spring boot版本相对应，请升级至2.X版本)

1.5.3.x版本适用于spring-boot 1.5.3版本；2.0.5.X版本适用于spring-boot 2.0.5版本； 2.1.7.X版本适用于spring-boot 2.1.7版本。

其它的spring-boot版本的适配未做测试。

== 安装依赖

[source,xml,indent=4]
----
        <dependency>
            <groupId>com.mengyunzhi</groupId>
            <artifactId>core</artifactId>
            <version>对应的版本号信息</version>
        </dependency>
----

== 综合查询

=== 实体
实体类，需要实现YunzhiEntity，并传入实体的主键类型
[source,java,indent=4]
----
@Entity
public class Klass implements YunzhiEntity<Long> {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;        // 班级名称
    private Short totalStudentCount;    // 学生总数
    private Integer integerTest;        // 整形测试
    private Long longTest;              // 长整形测试

    @ManyToOne
    private Teacher teacher;

    @ManyToOne
    @Ignore           // 忽略查询条件
    private Teacher ignoreTeacher;

    // setter and getter ..
}

----

=== 仓库类
[source,java,indent=4]
----
// 继承JpaSpecificationExecutor
public interface KlassRepository extends CrudRepository<Klass, Long>, JpaSpecificationExecutor {
}
----

== Appender日志推送

1. 配置yunzhi.monitor.enable=false, 配置yunzhi.monitor.url=日志服务器地址
2. 于资源文件夹新建logback-spring.xml文件，并复制以下内容：

[source,xml,indent=4]
----
<?xml version="1.0" encoding="UTF-8"?>
<!--开启debug模式-->
<configuration debug="false">
    <!--引入application配置信息-->
    <springProperty scope="context" name="monitorUrl" source="yunzhi.monitor.url"
                    defaultValue="localhost"/>

    <!--引入内置文件过滤器-->
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>

    <!--引用第appender, 命名为batchHttp-->
    <appender name="batchHttp" class="club.yunzhi.exam.appender.LogHttpAppender">
        <endpointUrl>${monitorUrl}</endpointUrl>
        <!--定义输出格式JSON-->
        <layout class="ch.qos.logback.contrib.json.classic.JsonLayout">
            <jsonFormatter
                    class="ch.qos.logback.contrib.jackson.JacksonJsonFormatter">
            </jsonFormatter>
        </layout>

        <!--定义过滤器-->
        <filter class="com.mengyunzhi.core.filter.LoggerMonitorFilter"/>
    </appender>
</configuration>
----

== 超密

CommonService中提供了makeOneTimePassword方法。在传入种子时推荐使用动态关键字+固定的种子的方法，以免种子被破解。

== 开发选项
1. 将注释掉的子TEST模块启用
2. 将签名的插件注释掉。

